var mediaupload=function($,e,t){var i=[function($){$.fn.mediaUpload=function(){var e=$(this);e.each(function(){var e,t=$(this),i=t.find(".upload-image-button"),a=t.find(".update-image-button"),n=t.find(".remove-image-button"),d=t.parent().data("multiple");$(i).click(function(i){i.preventDefault(),$(this).mediaEvent(t,e,"add",d)}),$(a).click(function(i){i.preventDefault(),$(this).mediaEvent(t,e,"edit","single")}),$(n).click(function(e){e.preventDefault(),"multiple"===d&&1!==t.parent().find(".image-upload").length?$(t).removeMediaElement():$(t).resetMediaElement()})})},$.fn.mediaEvent=function(e,t,i,a){var n=$(this),d=n.data("id"),r=n.data("title"),l=n.data("label"),o="single"!==a&&"add",m=$(e).parent();return void 0!==t?void t.open():(t=wp.media.frames.file_frame=wp.media({title:r,button:{text:l},library:{type:"image"},frame:"select",multiple:o}),t.on("select",function(){var n=t.state().get("selection");if(n.length>=2)n.map(function(t){var i=m.children().length-1,a=d.substring(0,d.lastIndexOf("-"))+"-"+i;$(e).multipleMediaElement(i,a,t.toJSON())}),m.reorderMediaElement(),m.applySortingEvents(),$(".image-upload").mediaUpload();else{var r=n.first().toJSON();"edit"===i?$(e).editMediaElement(d,r):$(e).addMediaElement(d,r,a)}}),void t.open())},$.fn.resetMediaElement=function(){var e=$(this);e.find('input[type="hidden"]').val(""),e.find(".regular-text, .widefat").attr("type","text"),e.find(".image-preview").find("a").html(""),e.find(".image-display").addClass("hidden"),e.find(".edit-image-action").addClass("hidden"),e.find(".upload-image-action").removeClass("hidden")},$.fn.addMediaElement=function(e,t,i){var a=$(this);"multiple"===i&&a.cloneMediaElement(),$("#"+e+"-id").val(t.id),$("#"+e+"-path").attr("type","hidden").val(t.url),a.find(".image-display").removeClass("hidden"),a.find(".image-preview").find("a").html('<img src="'+t.sizes.medium.url+'" class="image-media" alt="" />'),a.find(".upload-image-action").addClass("hidden"),a.find(".edit-image-action").removeClass("hidden"),a.parent().reorderMediaElement(),a.parent().applySortingEvents(),$(".image-upload").mediaUpload()},$.fn.editMediaElement=function(e,t){var i=$(this);$("#"+e+"-id").val(t.id),$("#"+e+"-path").attr("type","hidden").val(t.url),i.find(".image-preview").find("img").attr("src",t.sizes.medium.url),i.find(".edit-image-action").removeClass("hidden")},$.fn.removeMediaElement=function(){var e=$(this),t=e.parent();e.remove(),t.reorderMediaElement(),t.applySortingEvents(),t.find(".image-upload").each(function(){$(this).updateMediaElement()})},$.fn.multipleMediaElement=function(e,t,i){var a=$(this),n=a.parent();a.clone().html(function(e,t){return t.replace(/<img\s+[^>]*src="([^"]*)"[^>]*>/g,"")}).html(function(t,i){return i.replace(/\-\d+\"/g,"-"+(e+1)+'"')}).html(function(t,i){return i.replace(/\-\d+\-/g,"-"+(e+1)+"-")}).html(function(t,i){return i.replace(/\[\d+\]/g,"["+(e+1)+"]")}).attr("id",a.attr("id").replace(/\-\d+/g,"-"+(e+1))).appendTo(n),n.children().eq(e+1).resetMediaElement();var d=$("#"+t+"-upload");d.removeClass("sorting-disabled"),d.find("#"+t+"-id").val(i.id),d.find("#"+t+"-path").attr("type","hidden").val(i.url),d.find(".image-display").removeClass("hidden"),d.find(".image-preview").find("a").html('<img src="'+i.sizes.medium.url+'" class="image-media" alt="" />'),d.find(".upload-image-action").addClass("hidden"),d.find(".edit-image-action").removeClass("hidden")},$.fn.cloneMediaElement=function(){var e=$(this),t=e.parent(),i=e.clone(),a=e.index()+1;i.html(function(e,t){return t.replace(/<img\s+[^>]*src="([^"]*)"[^>]*>/g,"")}),i.attr("id",function(e,t){return t.replace(/\-\d+/g,"-"+a)}),i.find("[id]").each(function(){$(this).attr("id",$(this).attr("id").replace(/\-\d+/g,"-"+a))}),i.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(/\[\d+\]/g,"["+a+"]"))}),i.find("[data-target]").each(function(){$(this).attr("data-target",$(this).attr("data-target").replace(/\-\d+\-/g,"-"+a+"-"))}),i.find("[data-id]").each(function(){$(this).attr("data-id",$(this).attr("data-id").replace(/\-\d+/g,"-"+a))}),i.appendTo(t)},$.fn.updateMediaElement=function(){var e=$(this),t=e.index();e.attr("id",function(e,i){return i.replace(/\-\d+/g,"-"+t)}),e.find("[id]").each(function(){$(this).attr("id",$(this).attr("id").replace(/\-\d+/g,"-"+t))}),e.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(/\[\d+\]/g,"["+t+"]"))}),e.find("[data-target]").each(function(){$(this).attr("data-target",$(this).attr("data-target").replace(/\-\d+\-/g,"-"+t+"-"))}),e.find("[data-id]").each(function(){$(this).attr("data-id",$(this).attr("data-id").replace(/\-\d+/g,"-"+t))}),e.removeAttr("style")},$.fn.orderMediaElement=function(){var e=$(this);e.each(function(){var e=$(this),t=e.data("multiple");"multiple"===t&&e.sortable({opacity:.8,axis:"y",items:".image-upload:not(:last-child)",start:function(e,t){},update:function(e,t){},stop:function(e,t){$(this).children().each(function(e){var t=$(this),i=e+1;t.find(".image-ordering").val(i),t.find(".ordering-image-action em").text(i),t.removeAttr("style")})}})})},$.fn.redraw=function(){},$.fn.reorderMediaElement=function(){$(".image-upload",this).each(function(e){var t=$(this),i=e+1;t.find(".image-ordering").val(i),t.find(".ordering-image-action em").text(i),t.removeAttr("style")})},$.fn.applySortingEvents=function(){var e=$(this),t=$(this).children().length;e.children().each(function(){var e=$(this);t<=2?e.find(".ordering-image-action").addClass("hidden"):e.find(".ordering-image-action").removeClass("hidden"),e.find(".move-up-image-button").unbind("click").on("click",function(e){e.preventDefault(),$(this).moveUpMediaElement()}),e.find(".move-down-image-button").unbind("click").on("click",function(e){e.preventDefault(),$(this).moveDownMediaElement()})})},$.fn.moveUpMediaElement=function(){var e=$("#"+$(this).data("target"));return 0!==e.index()&&void e.fadeOut(300,function(){e.insertBefore(e.prev()),e.fadeIn(300),e.parent().reorderMediaElement()})},$.fn.moveDownMediaElement=function(){var e=$("#"+$(this).data("target")),t=e.parent().children().length-1;return e.index()!==t-1&&void e.fadeOut(300,function(){e.insertAfter(e.next()),e.fadeIn(300),e.parent().reorderMediaElement()})},$(".image-upload").mediaUpload(),$(".image-upload-wrapper").orderMediaElement()}],a=function(){n($,e,t)},n=function($,e,t){i.forEach(function(i){i($,e,t)})};return{init:a}}(jQuery,document,window);mediaupload.init();